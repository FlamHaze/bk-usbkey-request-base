var bkUsbkeyReqBase=function(){"use strict";var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var f=t(function(e,t){t.__esModule=!0,t.removeElementsByName=t.elementRemoveEvent=t.elementAddEvent=t.getElementsByClassName=void 0,t.getElementsByClassName=function(e){for(var t=document.getElementsByTagName("*"),n=t.length,r=[],o=0;o<n;o++){var a=t[o].className||"";if(!(a.indexOf(e)<0))for(var s=a.split(/\s+/),d=s.length,i=0;i<d;i++)e==s[i]&&r.push(t[o])}return r},t.elementAddEvent=function(e,t,n){e.saveEventHandle||(e.saveEventHandle=[]),e.saveEventHandle[t]=n,window.addEventListener?e.addEventListener(t,e.saveEventHandle[t],!1):window.attachEvent?e.attachEvent("on"+t,e.saveEventHandle[t]):e["on"+t]=e.saveEventHandle[t]},t.elementRemoveEvent=function(e,t){var n=e.saveEventHandle?e.saveEventHandle[t]:void 0;n&&(window.addEventListener?e.removeEventListener(t,n,!1):window.detachEvent?e.detachEvent("on"+t,n):e["on"+t]="")},t.removeElementsByName=function(e){for(var t=document.getElementsByName(e),n=t.length-1;0<=n;n--)try{document.body.removeChild(t[n])}catch(e){}}});e(f),f.removeElementsByName,f.elementRemoveEvent,f.elementAddEvent,f.getElementsByClassName;var n=t(function(e,t){var r,n=s&&s.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var o,n=(o=Error,n(a,o),a);function a(e){var t=o.call(this,e.message)||this;return t.name="CrossFormRequestSendError",t.code=e.code,t.errNameSign=e.errNameSign,t.successLength=e.successLength,t.totalOperateLength=e.totalOperateLength,t.jsonData=e.jsonData,t.strData=e.strData,t}t.default=n});e(n);var _=t(function(e,t){t.__esModule=!0,t.createCrossResponseError=void 0,t.createCrossResponseError=function(e){return new n.default(e)}});e(_),_.createCrossResponseError;var d=t(function(e,s){s.__esModule=!0,s.operateForm=s.operate=s.addForm=s.subOneFormCalc=s.addFormCalc=s.addIframe=s.FORM_NAME_PRE=s.FORM_CLASSNAME=s.IFRAME_NAME=s.IFRAME_ID=void 0;var r="BK_CROSS_FORM_REQUEST_FORM_CALC_ID",c="BK_CROSS_FORM_REQUEST_FORM_OPERATE_STATE_ID";s.IFRAME_ID="BK_CROSS_FORM_REQUEST_IFRAME_ID",s.IFRAME_NAME="BK_CROSS_FORM_REQUEST_IFRAME_NAME",s.FORM_CLASSNAME="BK_CROSS_FORM_REQUEST_FORM_CLASSNAME",s.FORM_NAME_PRE="BK_CROSS_FORM_REQUEST_FORM_NAME";var E="name-sign",u="BK_CROSS_FORM_REQUEST_FORM_REQUEST_TIMEOUT_FLAG";function d(){var e=document.getElementById(r);if(e){var t=parseInt(e.value);return e.value=t+1,t+1}t=document.createElement("input");return t.id=r,t.style.display="none",t.value="1",document.body.appendChild(t),1}function i(e,t,n){return o(e=void 0===e?function(){return!1}:e,t,n=void 0===n?!0:n)}function o(o,a,e,t){void 0===o&&(o=function(){return!1}),void 0===t&&(t={length:0});var n=document.getElementById(s.IFRAME_ID);if(!n)return new Promise(function(e,t){t(_.createCrossResponseError({code:"NO_REQUEST_TARGET_IFRAME",message:"目标iframe有可能已被删除,请刷新页面后重新尝试"}))});if(document.getElementById(c))return e?new Promise(function(t,n){var r=setInterval(function(){var e=i(o,a,!1);null!=e&&(clearInterval(r),e.then(function(e){t(e)}).catch(function(e){console.log("内部异常"),n(e)}))},1e3)}):null;e=document.createElement("div");return e.style.display="none",e.id=c,document.body.appendChild(e),function(d,i,e,u,m){var t=function(e){return document.getElementsByName(e)}(d),n=t.length;if(n<=0)return document.body.removeChild(e),null;var l=[];if(1==n)t[0].target=i.name,l.push(t[0]);else{for(var r=0;r<n;r++)t[r].target=i.name,l.push(t[r]);l.sort(function(e,t){e=parseInt(e.getAttribute("index")),t=parseInt(t.getAttribute("index"));return t<e?1:e==t?0:-1})}return new Promise(function(o,a){var s=void 0;f.elementRemoveEvent(window,"message"),f.elementAddEvent(window,"message",function(e){s&&clearTimeout(s);var t,n,r=e.data;if("string"==typeof r){t=r;try{n=JSON.parse(r)}catch(e){n=void 0}}else{try{t=JSON.stringify(r)}catch(e){t=void 0}n=r}r=i.getAttribute(E);if("function"==typeof m&&m(n,t))return f.removeElementsByName(d),f.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(c)),void a(_.createCrossResponseError({code:"CUSTOM_ERROR",message:"响应数据处理错误！",jsonData:n,strData:t,errNameSign:r,successLength:u.length,totalOperateLength:l.length+u.length+1}));u.length+=1,u[r]={name:r,data:{jsonData:n,strData:t}},0<l.length?s=v(i,l,u.length,a):(f.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(c)),o(u))}),s=v(i,l,0,a)})}(a,n,e,t,o)}s.addIframe=function(){var e,t=document.getElementById(r);if(e=t?(n=parseInt(t.value),""+s.FORM_NAME_PRE+n):s.FORM_NAME_PRE+"0",document.getElementById(s.IFRAME_ID))return e;var t=document.body,n=l("iframe",s.IFRAME_NAME);return n.id=s.IFRAME_ID,n.name=s.IFRAME_NAME,n.style.display="none",t.appendChild(n),e},s.addFormCalc=d,s.subOneFormCalc=function(){var e,t=document.getElementById(r);t&&(0!=(e=parseInt(t.value))?t.value=e-1:document.body.removeChild(t))},s.addForm=function(e,t){var n,r,o=l("form",t);for(n in o.action=e.url,o.method=e.method.toUpperCase(),o.style.display="none",e.data)"crosFlag"!=n&&((r=l("input",n)).name=n,r.value=e.data[n],o.appendChild(r));var a=l("input","crosFlag");a.name="crosFlag",a.value="1",o.appendChild(a),o.className=s.FORM_CLASSNAME,o.name=t,o.setAttribute(E,e.nameSign),o.setAttribute("index",d().toString()),o.setAttribute(u,e.timeOut.toString()),document.body.appendChild(o)},s.operate=i,s.operateForm=o;var v=function(e,t,n,r){var o,a=t.splice(0,1),s=a[0].getAttribute(E),d=a[0].getAttribute(u),i=a[0].name;try{o=parseInt(d)}catch(e){o=5e3}r=m(o,i,s,n,n+t.length+1,r);return e.setAttribute(E,s),a[0].submit(),document.body.removeChild(a[0]),r},m=function(e,t,n,r,o,a){if(!(e<=0)){var s=setTimeout(function(){clearTimeout(s),f.removeElementsByName(t),f.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(c));var e={code:"REQUEST_TIMEOUT",msg:"客户端访问超时"};a(_.createCrossResponseError({code:e.code,message:e.msg,errNameSign:n,strData:JSON.stringify(e),jsonData:e,successLength:r,totalOperateLength:o}))},e);return s}};function l(e,t){return window.ActiveXObject||"ActiveXObject"in window?document.createElement("<"+e+' name="'+t+'"></'+e+">"):document.createElement(e)}});return e(d),d.operateForm,d.operate,d.addForm,d.subOneFormCalc,d.addFormCalc,d.addIframe,d.FORM_NAME_PRE,d.FORM_CLASSNAME,d.IFRAME_NAME,d.IFRAME_ID,e(t(function(e,t){t.__esModule=!0,t.default=function(e,t){var n=d.addIframe();if(e instanceof Array){for(var r,o=0;o<e.length;o++)if(r=a(e[o],n))return r}else if(r=a(e,n))return r;return d.operate(t,n)};var a=function(e,t){if(!e.nameSign)return f.removeElementsByName(t),new Promise(function(e,t){t(_.createCrossResponseError({code:"ERR_nameSign",message:"未找到正确的方法签名"}))});e.method=e.method||"post",e.timeOut=e.timeOut||5e3,d.addForm(e,t)}}))}();
