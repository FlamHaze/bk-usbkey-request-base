"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var domExtends=createCommonjsModule(function(e,t){t.__esModule=!0,t.removeElementsByName=t.elementRemoveEvent=t.elementAddEvent=t.getElementsByClassName=void 0,t.getElementsByClassName=function(e){for(var t=document.getElementsByTagName("*"),n=t.length,o=[],r=0;r<n;r++){var a=t[r].className||"";if(!(a.indexOf(e)<0))for(var s=a.split(/\s+/),d=s.length,m=0;m<d;m++)e==s[m]&&o.push(t[r])}return o},t.elementAddEvent=function(e,t,n){e.saveEventHandle||(e.saveEventHandle=[]),e.saveEventHandle[t]=n,window.addEventListener?e.addEventListener(t,e.saveEventHandle[t],!1):window.attachEvent?e.attachEvent("on"+t,e.saveEventHandle[t]):e["on"+t]=e.saveEventHandle[t]},t.elementRemoveEvent=function(e,t){var n=e.saveEventHandle?e.saveEventHandle[t]:void 0;n&&(window.addEventListener?e.removeEventListener(t,n,!1):window.detachEvent?e.detachEvent("on"+t,n):e["on"+t]="")},t.removeElementsByName=function(e){for(var t=document.getElementsByName(e),n=t.length-1;0<=n;n--)try{document.body.removeChild(t[n])}catch(e){}}});unwrapExports(domExtends),domExtends.removeElementsByName,domExtends.elementRemoveEvent,domExtends.elementAddEvent,domExtends.getElementsByClassName;var CrossFormResponseError_1=createCommonjsModule(function(e,t){var o,n=commonjsGlobal&&commonjsGlobal.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var r,n=(r=Error,n(a,r),a);function a(e){var t=r.call(this,e.message)||this;return t.name="CrossFormRequestSendError",t.code=e.code,t.errNameSign=e.errNameSign,t.successLength=e.successLength,t.totalOperateLength=e.totalOperateLength,t.jsonData=e.jsonData,t.strData=e.strData,t}t.default=n});unwrapExports(CrossFormResponseError_1);var utils=createCommonjsModule(function(e,t){t.__esModule=!0,t.createCrossResponseError=void 0,t.createCrossResponseError=function(e){return new CrossFormResponseError_1.default(e)}});unwrapExports(utils),utils.createCrossResponseError;var domUtils=createCommonjsModule(function(e,s){s.__esModule=!0,s.operateForm=s.operate=s.addForm=s.subOneFormCalc=s.addFormCalc=s.addIframe=s.FORM_NAME_PRE=s.FORM_CLASSNAME=s.IFRAME_NAME=s.IFRAME_ID=void 0;var o="BK_CROSS_FORM_REQUEST_FORM_CALC_ID",E="BK_CROSS_FORM_REQUEST_FORM_OPERATE_STATE_ID";s.IFRAME_ID="BK_CROSS_FORM_REQUEST_IFRAME_ID",s.IFRAME_NAME="BK_CROSS_FORM_REQUEST_IFRAME_NAME",s.FORM_CLASSNAME="BK_CROSS_FORM_REQUEST_FORM_CLASSNAME",s.FORM_NAME_PRE="BK_CROSS_FORM_REQUEST_FORM_NAME";var v="name-sign",i="BK_CROSS_FORM_REQUEST_FORM_REQUEST_TIMEOUT_FLAG";function a(){var e=document.getElementById(o);if(e){var t=parseInt(e.value);return e.value=t+1,t+1}t=document.createElement("input");return t.id=o,t.style.display="none",t.value="1",document.body.appendChild(t),1}function d(e,t,n){return r(e=void 0===e?function(){return!0}:e,t,n=void 0===n?!0:n)}function r(r,a,e,t){void 0===r&&(r=function(){return!1}),void 0===t&&(t={length:0});var n=document.getElementById(s.IFRAME_ID);if(!n)return new Promise(function(e,t){t(utils.createCrossResponseError({code:"NO_REQUEST_TARGET_IFRAME",message:"目标iframe有可能已被删除,请刷新页面后重新尝试"}))});if(document.getElementById(E))return e?new Promise(function(t,n){var o=setInterval(function(){var e=d(r,a,!1);null!=e&&(clearInterval(o),e.then(function(e){t(e)}).catch(function(e){console.log("内部异常"),n(e)}))},1e3)}):null;e=document.createElement("div");return e.style.display="none",e.id=E,document.body.appendChild(e),function(m,i,e,l,u){var t=function(e){return document.getElementsByName(e)}(m),n=t.length;if(n<=0)return document.removeChild(e),null;var c=[];if(1==n)t[0].target=i.name,c.push(t[0]);else{for(var o=0;o<n;o++)t[o].target=i.name,c.push(t[o]);c.sort(function(e,t){e=parseInt(e.getAttribute("index")),t=parseInt(t.getAttribute("index"));return t<e?1:e==t?0:-1})}return new Promise(function(a,s){var d=void 0;domExtends.elementRemoveEvent(window,"message"),domExtends.elementAddEvent(window,"message",function(e){d&&clearTimeout(d);var t,n,o=e.data;if("string"==typeof o){t=o;try{n=JSON.parse(o)}catch(e){n=void 0}}else{try{t=JSON.stringify(o)}catch(e){t=void 0}n=o}var r=i.getAttribute(v);if("function"==typeof u&&u(n,t))return domExtends.removeElementsByName(m),domExtends.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(E)),void s(utils.createCrossResponseError({code:"CUSTOM_ERROR",message:"响应数据处理错误！",jsonData:n,strData:t,errNameSign:r,successLength:l.length,totalOperateLength:c.length+l.length+1}));l.length+=1,l[r]={name:r,data:{jsonData:n,strData:t}},0<c.length?d=_(i,c,l.length,s):(domExtends.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(E)),a(l))}),d=_(i,c,0,s)})}(a,n,e,t,r)}s.addIframe=function(){var e,t=document.getElementById(o);if(e=t?(n=parseInt(t.value),""+s.FORM_NAME_PRE+n):s.FORM_NAME_PRE+"0",document.getElementById(s.IFRAME_ID))return e;var t=document.body,n=document.createElement("iframe");return n.id=s.IFRAME_ID,n.name=s.IFRAME_NAME,n.style.display="none",t.appendChild(n),e},s.addFormCalc=a,s.subOneFormCalc=function(){var e,t=document.getElementById(o);t&&(0!=(e=parseInt(t.value))?t.value=e-1:document.removeChild(t))},s.addForm=function(e,t){var n,o=document.createElement("form");for(n in o.action=e.url,o.method=e.method.toUpperCase(),o.style.display="none",e.data){var r=document.createElement("input");r.name=n,r.value=e.data[n],o.appendChild(r)}o.className=s.FORM_CLASSNAME,o.name=t,o.setAttribute(v,e.nameSign),o.setAttribute("index",a().toString()),o.setAttribute(i,e.timeOut.toString()),document.body.appendChild(o)},s.operate=d,s.operateForm=r;var _=function(e,t,n,o){var r,a=t.splice(0,1),s=a[0].getAttribute(v),d=a[0].getAttribute(i),m=a[0].name;try{r=parseInt(d)}catch(e){r=5e3}o=l(r,m,s,n,n+t.length+1,o);return e.setAttribute(v,s),a[0].submit(),document.body.removeChild(a[0]),o},l=function(e,t,n,o,r,a){var s=setTimeout(function(){clearTimeout(s),domExtends.removeElementsByName(t),domExtends.elementRemoveEvent(window,"message"),document.body.removeChild(document.getElementById(E));var e={code:"REQUEST_TIMEOUT",msg:"客户端访问超时"};a(utils.createCrossResponseError({code:e.code,message:e.msg,errNameSign:n,strData:JSON.stringify(e),jsonData:e,successLength:o,totalOperateLength:r}))},e);return s}});unwrapExports(domUtils),domUtils.operateForm,domUtils.operate,domUtils.addForm,domUtils.subOneFormCalc,domUtils.addFormCalc,domUtils.addIframe,domUtils.FORM_NAME_PRE,domUtils.FORM_CLASSNAME,domUtils.IFRAME_NAME,domUtils.IFRAME_ID;var lib=createCommonjsModule(function(e,t){t.__esModule=!0,t.default=function(e,t){var n=domUtils.addIframe();if(e instanceof Array){for(var o,r=0;r<e.length;r++)if(o=a(e[r],n))return o}else if(o=a(e,n))return o;return domUtils.operate(t,n)};var a=function(e,t){if(!e.nameSign)return domExtends.removeElementsByName(t),new Promise(function(e,t){t(utils.createCrossResponseError({code:"ERR_nameSign",message:"未找到正确的方法签名"}))});e.method=e.method||"post",e.timeOut=e.timeOut||5e3,domUtils.addForm(e,t)}}),index=unwrapExports(lib);module.exports=index;
